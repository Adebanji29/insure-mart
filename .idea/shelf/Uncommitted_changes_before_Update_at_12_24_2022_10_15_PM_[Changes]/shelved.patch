Index: lib/Payment/payment_page.dart
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import 'dart:io';\r\n\r\nimport 'package:firebase_auth/firebase_auth.dart';\r\nimport 'package:flutter/cupertino.dart';\r\nimport 'package:flutter/material.dart';\r\nimport 'package:flutter_paystack/flutter_paystack.dart';\r\nimport 'package:insuremart/Backend%20models/Insurancemodel.dart';\r\nimport 'package:insuremart/Backend%20models/cardModel.dart';\r\nimport 'package:provider/provider.dart';\r\n\r\nimport '../Constant/key.dart';\r\nimport '../provider/insurance_provider.dart';\r\nimport '../provider/new_insurance_provider.dart';\r\nimport '../screen/home/request_hardcopy.dart';\r\nimport '../screen/main_screen.dart';\r\nimport '../utils/app_theme.dart';\r\nimport '../widget/buttons.dart';\r\n\r\nclass MakePayment{\r\n  InsuranceModel insurancemodel;\r\n  CardModel cardModel;\r\n  BuildContext context;\r\n  String email;\r\n  int price;\r\n  PaystackPlugin _paystack= PaystackPlugin();\r\n  MakePayment({required this.context, required this.email, required this.price, required this.cardModel, required this.insurancemodel});\r\n\r\nUser? currentUser= FirebaseAuth.instance.currentUser;\r\n\r\n  String getReference(){\r\n     String platform;\r\n     if(Platform.isIOS){\r\n       platform= \"iOS\";\r\n     }\r\n     else\r\n       {platform= \"Android\";}\r\n\r\n     return 'ChargedFrom${platform}_${DateTime.now().millisecondsSinceEpoch}';\r\n  }\r\n\r\n  PaymentCard getCardUI(){\r\n    return PaymentCard(\r\n        number:cardModel.cardNumber,\r\n        cvc: cardModel.cardCVV,\r\n        expiryMonth: 0,\r\n        expiryYear: 0);\r\n  }\r\n\r\n  Future initializeplugin() async{\r\n    await _paystack.initialize(publicKey: ConstantKey.PAYSTACK_KEY);\r\n  }\r\n\r\n  chargeCardAndMakePayment() async{\r\n\r\n    initializeplugin().then((_) async {\r\n      Charge charge= Charge()\r\n          ..amount= price*100\r\n          ..email= email\r\n          ..reference= getReference()\r\n          ..card= getCardUI();\r\n\r\n      CheckoutResponse response= await _paystack.checkout(\r\n          context,\r\n          charge:charge,\r\n          method: CheckoutMethod.card,\r\n      fullscreen: false,\r\n      logo: FlutterLogo(\r\n        size: 24,\r\n      ));\r\n      print('Response $response');\r\n      if(response.status == true){\r\n        print(\"Transaction successful\");\r\n        InsuranceProvider insuranceProvider= Provider.of<InsuranceProvider>(context, listen: false);\r\n        insuranceProvider.saveNewInsuranceInfo(insurancemodel,context);\r\n\r\n\r\n\r\n        final ref = context.read<NewInsuranceManager>();\r\n        showModalBottomSheet(\r\n              enableDrag: false,\r\n              backgroundColor: InsuremartTheme.white1.withOpacity(.9),\r\n              isScrollControlled: true,\r\n              context: context,\r\n              builder: (context) => Padding(\r\n                padding: const EdgeInsets.symmetric(horizontal: 20),\r\n                child: Column(\r\n                  mainAxisSize: MainAxisSize.max,\r\n                  mainAxisAlignment: MainAxisAlignment.center,\r\n                  children: [\r\n                    Image.asset('assets/images/insured.png'),\r\n                    const SizedBox(height: 20),\r\n                    Text(\r\n                      'Your Car Is Insured!',\r\n                      style: InsuremartTheme.lightTextTheme.headline2!.copyWith(\r\n                        fontSize: 24,\r\n                        color: InsuremartTheme.blue1,\r\n                      ),\r\n                    ),\r\n                    Text(\r\n                      'Order number: ${insurancemodel.purchaseId.toString()}',\r\n                      style: InsuremartTheme.lightTextTheme.bodyText2!.copyWith(\r\n                        fontSize: 13,\r\n                        color: InsuremartTheme.black4.withOpacity(.5),\r\n                      ),\r\n                    ),\r\n                    const SizedBox(height: 50),\r\n                    LongButton(title: 'VIEW CERTIFICATE', onPressed: () {}),\r\n                    const SizedBox(height: 15),\r\n                    LongButton(title: 'VIEW POLICY DOCUMENT', onPressed: () {}),\r\n                    const SizedBox(height: 15),\r\n                    LongButton(\r\n                      title: 'REQUEST FOR HARD COPY',\r\n                      onPressed: () {\r\n                        ref.gotoStep(0);\r\n                        Navigator.of(context).pop();\r\n                        Navigator.of(context).pop();\r\n                        Navigator.of(context).pushNamed(RequestHardcopy.route);\r\n                      },\r\n                    ),\r\n                    const SizedBox(height: 15),\r\n                    LongButton(\r\n                      title: 'BUY ANOTHER ONE',\r\n                      onPressed: () {\r\n                        ref.gotoStep(0);\r\n                        Navigator.of(context).pop();\r\n                      },\r\n                      isBorder: true,\r\n                      color: InsuremartTheme.white1,\r\n                      textColor: InsuremartTheme.blue2,\r\n                    ),\r\n                    const SizedBox(height: 15),\r\n                    LongButton(\r\n                      title: 'GO HOME',\r\n                      onPressed: () {\r\n                        ref.gotoStep(0);\r\n                        Navigator.of(context).pop();\r\n                        Navigator.of(context).pop();\r\n                      },\r\n                      isBorder: true,\r\n                      color: InsuremartTheme.white1,\r\n                      textColor: InsuremartTheme.blue2,\r\n                    ),\r\n                  ],\r\n                ),\r\n              ));\r\n            //\r\n\r\n\r\n\r\n            }\r\n      else{\r\n        print (\"Transaction failed\");\r\n        showDialog(context: context, builder:(context) =>\r\n        AlertDialog(\r\n          content: Text(\r\n            \"Transaction failed\"\r\n          ),\r\n        ));\r\n        Navigator.pushReplacement(context, MaterialPageRoute(builder: (context)=> Main()));\r\n\r\n\r\n      }\r\n    }\r\n    );\r\n\r\n  }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/Payment/payment_page.dart b/lib/Payment/payment_page.dart
--- a/lib/Payment/payment_page.dart	
+++ b/lib/Payment/payment_page.dart	
@@ -1,6 +1,5 @@
 import 'dart:io';
 
-import 'package:firebase_auth/firebase_auth.dart';
 import 'package:flutter/cupertino.dart';
 import 'package:flutter/material.dart';
 import 'package:flutter_paystack/flutter_paystack.dart';
@@ -25,7 +24,6 @@
   PaystackPlugin _paystack= PaystackPlugin();
   MakePayment({required this.context, required this.email, required this.price, required this.cardModel, required this.insurancemodel});
 
-User? currentUser= FirebaseAuth.instance.currentUser;
 
   String getReference(){
      String platform;
@@ -71,7 +69,7 @@
       if(response.status == true){
         print("Transaction successful");
         InsuranceProvider insuranceProvider= Provider.of<InsuranceProvider>(context, listen: false);
-        insuranceProvider.saveNewInsuranceInfo(insurancemodel,context);
+        insuranceProvider.saveNewInsuranceInfo(insurancemodel);
 
 
 
